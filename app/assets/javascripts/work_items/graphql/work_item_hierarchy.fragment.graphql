#import "~/graphql_shared/fragments/page_info.fragment.graphql"
#import "ee_else_ce/work_items/graphql/work_item_metadata_widgets.fragment.graphql"

fragment WorkItemHierarchy on WorkItem {
  id
  workItemType {
    id
    name
    iconName
  }
  title
  confidential
  userPermissions {
    updateWorkItem
    adminParentLink
    setWorkItemMetadata
  }
  widgets(onlyTypes: [HIERARCHY]) {
    ... on WorkItemWidgetHierarchy {
      type
      hasChildren
      hasParent
      depthLimitReachedByType {
        workItemType {
          id
          name
        }
        depthLimitReached
      }
      rolledUpCountsByType {
        countsByState {
          opened
          all
          closed
        }
        workItemType {
          id
          name
          iconName
        }
      }
      parent {
        id
      }
      children(first: $pageSize, after: $endCursor) {
        pageInfo {
          ...PageInfo
        }
        count
        nodes {
          id
          iid
          confidential
          workItemType {
            id
            name
            iconName
          }
          namespace {
            id
            fullPath
            name
          }
          title
          state
          createdAt
          closedAt
          webUrl
          reference(full: true)
          widgets(
            onlyTypes: [HIERARCHY, ASSIGNEES, LABELS, LINKED_ITEMS, MILESTONE, START_AND_DUE_DATE]
          ) {
            ... on WorkItemWidgetHierarchy {
              type
              hasChildren
              rolledUpCountsByType {
                countsByState {
                  all
                  closed
                }
                workItemType {
                  id
                  name
                  iconName
                }
              }
            }
            ...WorkItemMetadataWidgets
          }
        }
      }
    }
  }
}
